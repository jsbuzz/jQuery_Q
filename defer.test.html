<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>$.Q test</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js" ></script>
	<script src="jquery.Q.js" ></script>
	<script src="test.filesystem.js" ></script>
	<script>
		function somethingAsync(rarity, success, error) {
			setTimeout(
				function() {

					if(Math.random()*10 > rarity) {
						success(rarity);
					} else {
						console.log(' [failed with ' + rarity + ']');
						error(rarity);
					}
				},
				100
			)
		}

		function stupidAsync(rarity, success) {
			setTimeout(
				function() {
					if(Math.random()*10 > rarity) {
						success(rarity);
					} else {
						this.log(' [+failed with ' + rarity + ']');
					}
				}.bind(this),
				100
			)
		}

		var tasks = [];

		for(var i=1; i < 10; i++) {
			tasks.push($.Q.defer(somethingAsync, i));
		}
		tasks.push($.Q.debug.success('no surprise'));
		tasks.push($.Q.debug.failure('no surprise'));

		$.when(
			$.Q.someOf(tasks)
		).done(function(results) {
			console.log('done', results);
		}).fail(function(errors) {
			console.log('all failed', errors);
		});
	</script>
</head>
<body>
	Check the console.
</body>
</html>
